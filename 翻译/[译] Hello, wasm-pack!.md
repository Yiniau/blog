> ---
>
> title: [è¯‘] Hello, wasm-pack!
>
> date: 2018-4-28  7:29:00
>
> categories: ç¿»è¯‘
>
> tags: WebAssembly
>
> source: [åŸæ–‡åœ°å€](https://hacks.mozilla.org/2018/04/hello-wasm-pack/?utm_source=dev-newsletter&utm_medium=email&utm_campaign=apr26-2018)
>
> auther: [Ashley Williams](https://github.com/ashleygwilliams)
>
> ---

# [è¯‘] Hello, wasm-pack!

---

æ­£å¦‚[Lin Clarkåœ¨å¥¹çš„å…³äºRustå’ŒWebAssemblyçš„æ–‡ç« ](https://hacks.mozilla.org/2018/03/making-webassembly-better-for-rust-for-all-languages/)ä¸­å¼ºè°ƒçš„é‚£æ ·ï¼šWebAssemblyçš„ç›®æ ‡ä¸æ˜¯å–ä»£JavaScriptï¼Œè€Œæ˜¯**æˆä¸ºä¸€ä¸ªéå¸¸æ£’çš„JavaScriptå·¥å…·**ã€‚ä¸ºäº†ç®€åŒ–è·¨è¶ŠJavaScriptå’ŒWebAssemblyä¹‹é—´çš„è¯­è¨€ç•Œé™ï¼Œå·²ç»æ¶Œç°äº†è®¸å¤šè®¸å¤šä»¤äººæƒŠå¹çš„æˆæœï¼Œä½ å¯ä»¥é˜…è¯»[Alex Crichtonåœ¨wasm-bindgenä¸Šå‘å¸ƒçš„æ‰€æœ‰å†…å®¹](https://hacks.mozilla.org/2018/04/javascript-to-rust-and-back-again-a-wasm-bindgen-tale/)ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»ä¸åŒç±»å‹çš„ JavaScript/Rust é›†æˆï¼šè½¯ä»¶åŒ…ç”Ÿæ€ç³»ç»Ÿ(package ecosystem)å’Œå¼€å‘äººå‘˜å·¥ä½œæµç¨‹(developer workflows)ã€‚

Rustå’ŒJavaScriptéƒ½æœ‰å……æ»¡æ´»åŠ›çš„åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿã€‚Rustæœ‰[cargo](https://github.com/rust-lang/cargo)å’Œ[crates.io](https://crates.io/)ã€‚JavaScriptæœ‰ [å‡ ä¸ª](https://yarnpkg.com/en/) [CLI](https://github.com/pnpm/pnpm) [å·¥å…·](https://github.com/cnpm/cnpm)ï¼ŒåŒ…æ‹¬ä¸npmæ³¨å†Œè¡¨è¿æ¥çš„npm CLIã€‚ä¸ºäº†ä½¿WebAssemblyè·å¾—æˆåŠŸï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¸¤ä¸ªç³»ç»Ÿè‰¯å¥½åœ°ååŒå·¥ä½œï¼Œç‰¹åˆ«æ˜¯ï¼š

- Rustå¼€å‘äººå‘˜åº”è¯¥èƒ½å¤Ÿç”Ÿæˆç”¨äºJavaScriptçš„WebAssemblyåŒ…ï¼Œè€Œä¸éœ€è¦Node.jså¼€å‘ç¯å¢ƒ
- JavaScriptå¼€å‘äººå‘˜åº”è¯¥èƒ½å¤Ÿä½¿ç”¨WebAssemblyè€Œä¸éœ€è¦Rustå¼€å‘ç¯å¢ƒ

âœ¨ğŸ“¦ Enter: `wasm-pack`.

`wasm-pack` **æ˜¯ç”¨äºç»„è£…å’ŒåŒ…è£…ä»¥WebAssemblyä¸ºç›®æ ‡çš„RuståŒ…è£…ç®±çš„å·¥å…·ã€‚è¿™äº›è½¯ä»¶åŒ…å¯ä»¥å‘å¸ƒåˆ°npm Registryå¹¶ä¸å…¶ä»–è½¯ä»¶åŒ…ä¸€èµ·ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å°†å®ƒä»¬ä¸JSå’Œå…¶ä»–è½¯ä»¶åŒ…å¹¶è¡Œä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è®¸å¤šç±»å‹çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨**ï¼Œä¾‹å¦‚Node.jsæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼ŒWebpackæ†ç»‘çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæˆ–ä»»ä½•å…¶ä»–ç±»å‹çš„åº”ç”¨ç¨‹åºä½¿ç”¨npmä¾èµ–å…³ç³»ã€‚ä½ å¯ä»¥åœ¨[crates.io](https://crates.io/crates/wasm-pack)å’Œ[GitHub](https://github.com/ashleygwilliams/wasm-pack)ä¸Šæ‰¾åˆ°  `wasm-pack` ã€‚

è¿™ä¸ªå·¥å…·çš„å¼€å‘åˆšåˆšå¼€å§‹ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´èƒ½å¤Ÿä»æ¶‰åŠRustå’ŒJavaScriptçš„å¼€å‘äººå‘˜ä¸­è·å¾—æ›´å¤šçš„å¸®åŠ©ã€‚JavaScriptå’ŒRustç”Ÿæ€ç³»ç»Ÿéƒ½ä¸“æ³¨äºå¼€å‘è€…ä½“éªŒã€‚æˆ‘ä»¬é¦–å…ˆçŸ¥é“ï¼Œç”Ÿäº§é«˜æ•ˆçš„ç”Ÿæ€ç³»ç»Ÿçš„å…³é”®æ˜¯ä½¿è‡ªåŠ¨æ‰§è¡Œæ¯ç‡¥ä»»åŠ¡å¹¶æ‘†è„±å¼€å‘äººå‘˜æ–¹å¼çš„å¥½å·¥å…·ã€‚é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªé«˜æ•ˆç”Ÿäº§çš„ç”Ÿæ€ç³»ç»Ÿçš„å…³é”®æ˜¯è‡ªåŠ¨æ‰§è¡Œæ¯ç‡¥ä»»åŠ¡å¹¶ä½¿å¼€å‘äººå‘˜æ‘†è„±æ— èŠæ–¹å¼çš„å¥½å·¥å…·ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºæˆ‘ä»¬çš„è¿›åº¦ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ï¼Œå¦‚ä½•å¼€å§‹ä½¿ç”¨å·¥å…·ï¼Œä»¥åŠå¦‚ä½•å‚ä¸å¡‘é€ æœªæ¥ã€‚

## ğŸ’ What it does today

![](https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/04/s_A9A8C3816B05444A18E82A6772DDBA985038B68FF6B90B7266556F8069E039E0_1523913938177_wasm-pack2-02.png)

ç°åœ¨ï¼Œ`wasm-pack` å¼•å¯¼ä½ å®Œæˆå››ä¸ªåŸºæœ¬æ­¥éª¤ï¼Œå‡†å¤‡å°†ä½ çš„Rustä»£ç ä½œä¸ºWebAssemblyåŒ…å‘å¸ƒåˆ°npmæ³¨å†Œè¡¨ä¸­ï¼š

### 1. Compile to WebAssembly

`wasm-pack` å°†ä½¿ç”¨ `rustup` æ·»åŠ ç›¸åº”çš„WebAssemblyç¼–è¯‘ç›®æ ‡ï¼Œå¹¶ä»¥å‘å¸ƒæ¨¡å¼ç¼–è¯‘Ruståˆ°WebAssemblyã€‚

- å¦‚æœéœ€è¦ï¼Œæ·»åŠ wasm32-unknown-unknownç¼–è¯‘ç›®æ ‡
- å°†ä½ çš„é¡¹ç›®ç¼–è¯‘åˆ°å‘å¸ƒç‰ˆæœ¬

### 2. Run wasm-bindgen

`wasm-pack` åŒ…è£…äº† `wasm-bindgen` å·¥å…·çš„CLIéƒ¨åˆ†å¹¶ä¸ºä½ è¿è¡Œå®ƒï¼è¿™å¯ä»¥å°†WebAssemblyæ¨¡å—å°è£…åœ¨JSåŒ…è£…ä¸­ï¼Œè¿™æ ·äººä»¬å¯ä»¥æ›´è½»æ¾åœ°ä¸æ¨¡å—è¿›è¡Œäº¤äº’ã€‚`wasm-bindgen` åŒæ—¶æ”¯æŒES6æ¨¡å—å’ŒCommonJSï¼Œä½ å¯ä»¥ä½¿ç”¨ `wasm-pack` ç”Ÿæˆä»»æ„ç±»å‹çš„åŒ…ï¼

### 3. Generate package.json

`wasm-pack` ä¼šè¯»å–ä½ çš„ `Cargo.toml` å¹¶ç”Ÿæˆå°†ä½ çš„è½¯ä»¶åŒ…å‘å¸ƒåˆ°npmæ³¨å†Œè¡¨æ‰€éœ€çš„package.jsonæ–‡ä»¶ã€‚å®ƒä¼šï¼š

- å¤åˆ¶ä½ çš„é¡¹ç›®åç§°å’Œè¯´æ˜
- é“¾æ¥åˆ°ä½ çš„Rusté¡¹ç›®çš„å­˜å‚¨åº“
- åˆ—å‡ºæ–‡ä»¶å¯†é’¥ä¸­ç”Ÿæˆçš„JavaScriptæ–‡ä»¶ã€‚è¿™å¯ä»¥ç¡®ä¿æœ‰ä¸”åªæœ‰è¿™äº›æ–‡ä»¶åŒ…å«åœ¨npmåŒ…ä¸­ã€‚å¦‚æœä½ æ‰“ç®—åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨æ­¤è½¯ä»¶åŒ…æˆ–åŒ…å«æ­¤è½¯ä»¶åŒ…çš„è½¯ä»¶åŒ…ï¼Œè¿™å¯¹äºç¡®ä¿è‰¯å¥½çš„æ€§èƒ½å°¤ä¸ºé‡è¦ï¼

### 4. Documentation

`wasm-pack` ä¼šå°†ä½ çš„Rusté¡¹ç›®çš„README.mdå¤åˆ¶åˆ°å®ƒç”Ÿæˆçš„npmåŒ…ä¸­ã€‚æˆ‘ä»¬æœ‰å¾ˆå¤šå…³äºå¦‚ä½•è¿›ä¸€æ­¥æ‰©å±•ä»¥æ”¯æŒRustç”Ÿæ€ç³»ç»Ÿçš„æ–‡æ¡£åŠŸèƒ½rustdocçš„æ›´å¤šæƒ³æ³• - æ›´å¤šå†…å®¹è¯·å‚è§ä¸‹ä¸€èŠ‚ï¼

## ğŸ”® æœªæ¥è®¡åˆ’

### ä¸`rustdoc`é›†æˆ

crates.ioå›¢é˜Ÿå¯¹å¼€å‘äººå‘˜è¿›è¡Œäº†è°ƒæŸ¥ï¼Œå¹¶äº†è§£åˆ°å¼€å‘äººå‘˜åœ¨ä½¿ç”¨crateæ—¶çš„æƒ…å†µæ—¶æœ€å¸Œæœ›è·å¾—çš„æ˜¯ä¼˜ç§€çš„æ–‡æ¡£ã€‚è´¡çŒ®è€…[Yoshua Wuyts](https://github.com/yoshuawuyts)ä»‹ç»äº†é€šè¿‡å°†rust-packä¸Rust APIæ–‡æ¡£å·¥å…·`rustdoc`é›†æˆæ¥ç”Ÿæˆæ›´å¤šREADME.mdå†…å®¹çš„ç»å¦™æƒ³æ³•ã€‚Rust-wasmå›¢é˜Ÿè‡´åŠ›äºä½¿Rustæˆä¸ºç¼–å†™WebAssemblyçš„ä¸€æµæ–¹å¼ã€‚æä¾›Rustç”Ÿæˆçš„WebAssemblyè½¯ä»¶åŒ…çš„æ–‡æ¡£ï¼Œè¿™äº›è½¯ä»¶åŒ…æ˜“äºç¼–å†™ï¼Œæ˜“äºå‘ç°ï¼Œä¸æˆ‘ä»¬çš„ç›®æ ‡å®Œç¾åŒ¹é…ã€‚è¯¦ç»†äº†è§£å›¢é˜Ÿåœ¨[è¿™ä¸ªiusse](https://github.com/ashleygwilliams/wasm-pack/issues/7#issuecomment-368551714)ä¸Šçš„æƒ³æ³•å¹¶åŠ å…¥è®¨è®ºï¼

### ç®¡ç†å’Œä¼˜åŒ–ä½ çš„Rustå’ŒJSä¾èµ–å…³ç³»å›¾

ä¸‹ä¸€ä¸ªå…³äº`wasm-pack`çš„å¤§å‹å¼€å‘å·¥ä½œå°†ç€é‡äºåœ¨ç¼–è¯‘çš„WebAssemblyä¸­ä½¿ç”¨è‡ªå®šä¹‰æ®µæ¥å£°æ˜å¯¹æœ¬åœ°Javascriptæ–‡ä»¶æˆ–å…¶ä»–npmåŒ…çš„ä¾èµ–å…³ç³»ã€‚

è¿™ä¸ªåŠŸèƒ½çš„åˆæ­¥å·¥ä½œå·²ç»è½åœ¨`wasm-bindgen`ä¸­ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°†æŠŠå®ƒæ•´åˆåˆ°`wasm-pack`ä¸­ã€‚å¼€å§‹çš„æ•´åˆä¸ä¼šå¤ªæ£˜æ‰‹ - ä½†æˆ‘ä»¬å¾ˆé«˜å…´æ‹¥æœ‰å¿…é¡»ç®€åŒ–å’Œä¼˜åŒ–Rustä¾èµ–å…³ç³»æ ‘çš„æ¢ç´¢æœºä¼šï¼Œè¿™äº›ä¾èµ–å…³ç³»æ ‘åœ¨å‡ ä¸ªå±‚æ¬¡ä¸ŠåŒ…å«npmä¾èµ–å…³ç³»ï¼è¿™é¡¹å·¥ä½œä¸Webpackè¿™æ ·çš„æ†ç»‘è½¯ä»¶æä¾›çš„ä¼˜åŒ–ç±»ä¼¼ï¼Œä½†æ˜¯Rustå±‚é¢çš„ä¾èµ–å…³ç³»ã€‚

æˆ‘ä»¬ä»ç„¶éœ€è¦è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œå¹¶ä¸”è¦åšè®¸å¤šç®€å•çš„å·¥ç¨‹å·¥ä½œã€‚åœ¨å‡ ä¸ªæ˜ŸæœŸå†…ï¼Œè¿™ä¸ªä¸»é¢˜ä¼šæœ‰ä¸€ä¸ªå®Œæ•´çš„å¸–å­ï¼Œæ‰€ä»¥è¯·ç•™æ„ï¼

![](https://2r4s9p1yi1fa2jd7j43zph8r-wpengine.netdna-ssl.com/files/2018/04/s_A9A8C3816B05444A18E82A6772DDBA985038B68FF6B90B7266556F8069E039E0_1523916327709_wasm-pack3-03.png)

### åœ¨Rustä¸­å¢åŠ Node.jså·¥å…·é“¾

è¿™ä¸ªé¡¹ç›®æœ€å¤§ä¸”æœ€é›„å¿ƒå‹ƒå‹ƒçš„ç›®æ ‡æ˜¯åœ¨Rustä¸­é‡å†™æ‰€éœ€çš„`npm login`ï¼Œ`npm pack`å’Œ`npm publish`æ­¥éª¤ï¼Œä»¥ä¾¿å¯¹äºé‚£äº›ç›®å‰ä¸ä½¿ç”¨Node.jsçš„äººæ¥è¯´ï¼Œå¯¹Node.jså¼€å‘ç¯å¢ƒçš„æ‰€éœ€ä¾èµ–åœ¨å…¶å·¥ä½œæµç¨‹ä¸­å˜å¾—å¯é€‰ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„ï¼Œæˆ‘ä»¬å¸Œæœ›ç¡®ä¿WebAssemblyåŒ…å¼€å‘è€…å’Œç”¨æˆ·éƒ½å¯ä»¥ç»§ç»­ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰çš„å·¥ä½œæµç¨‹ã€‚ç›®å‰ï¼ŒJavaScriptå¼€å‘äººå‘˜çš„ç¡®å¦‚æ­¤ - ä»–ä»¬ä¸éœ€è¦æ‹¥æœ‰Rustå¼€å‘ç¯å¢ƒæˆ–Rustçš„ä»»ä½•çŸ¥è¯†å³å¯å¼€å§‹ä½¿ç”¨å·²ä½¿ç”¨`wasm-pack`å‘å¸ƒçš„ä½¿ç”¨Rustç”Ÿæˆçš„WebAssemblyæ¨¡å—ã€‚

### ä¸npmå’Œæ‰“åŒ…å™¨åä½œ

æˆ‘ä»¬ä¸€ç›´ä¸npm CLIå›¢é˜Ÿæˆå‘˜[Kat Marchan](https://github.com/zkat)å’Œ[Rebecca Turner](https://github.com/iarna)ä»¥åŠ[webpack](https://webpack.js.org/)å’Œ[Parcel](https://parceljs.org/)å·¥ä½œäººå‘˜è¿›è¡Œäº¤æµ - æˆ‘ä»¬å¾ˆé«˜å…´ä¸ä»–ä»¬ç»§ç»­åˆä½œï¼Œä»¥ä¾¿å¼€å‘äººå‘˜è½»æ¾å‘å¸ƒå’Œä½¿ç”¨WebAssemblyä»£ç ï¼

## ğŸ›  Start using it today!

`wasm-pack`ç›®å‰æ˜¯é€šè¿‡Cargoå‘å¸ƒçš„å‘½ä»¤è¡Œå·¥å…·ã€‚è¦å®‰è£…å®ƒï¼Œè¯·[å®‰è£…Rustå¼€å‘ç¯å¢ƒ](https://www.rust-lang.org/en-US/install.html)ï¼Œç„¶åè¿è¡Œï¼š
```bash
cargo install wasm-pack
```

å¦‚æœæ‚¨ä¸ç¡®å®šä»å“ªé‡Œå¼€å§‹ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æä¾›äº†[ä¸€ä¸ªæ•™ç¨‹](https://rust-lang-nursery.github.io/rust-wasm/wasm-pack/introduction.html)ï¼æœ¬æ•™ç¨‹ç”±[Michael Gattozzi](https://github.com/mgattozzi)å’ŒRust-wasmå·¥ä½œå°ç»„å¸¦é¢†æ‚¨ï¼š

- å†™ä¸€ä¸ªå°çš„Ruståº“
- å°†å…¶ç¼–è¯‘ä¸ºWebAssemblyï¼Œæ‰“åŒ…å¹¶ä½¿ç”¨wasm-packè¿›è¡Œå‘å¸ƒ
- æ†ç»‘webpackåˆ¶ä½œä¸€ä¸ªå°å‹ç½‘ç«™

![](https://d2mxuefqeaa7sj.cloudfront.net/s_A9A8C3816B05444A18E82A6772DDBA985038B68FF6B90B7266556F8069E039E0_1524011130215_demo.gif)

## ğŸ‘¯â€â™€ï¸è´¡çŒ®

æ‰€æœ‰ä¼˜ç§€çš„å¼€å‘äººå‘˜å·¥å…·çš„å…³é”®æ˜¯è¯¥å·¥å…·çš„å¼€å‘äººå‘˜ä¸åœ¨æ—¥å¸¸å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨è¯¥å·¥å…·çš„å¼€å‘äººå‘˜ä¹‹é—´çš„çŸ­åé¦ˆå‘¨æœŸã€‚

ä¸ºäº†è®©wasm-packæ›´å®Œç¾ï¼Œä¹Ÿä¸ºæˆ‘ä»¬æ‰€æœ‰çš„WebAssemblyå¼€å‘äººå‘˜å·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦æ‰€æœ‰æŠ€èƒ½æ°´å¹³å’ŒèƒŒæ™¯çš„å¼€å‘äººå‘˜å‚ä¸å…¶ä¸­ï¼

çœ‹çœ‹æˆ‘ä»¬çš„[è´¡çŒ®è€…æŒ‡å—](https://github.com/ashleygwilliams/wasm-pack/blob/master/CONTRIBUTING.md)å’Œ[é—®é¢˜è·Ÿè¸ªå™¨](https://github.com/ashleygwilliams/wasm-pack/issues)ï¼ˆæˆ‘ä»¬å®šæœŸå°†äº‹æƒ…æ ‡è®°ä¸ºâ€œ[ä¼˜å…ˆçš„å¥½é—®é¢˜](https://github.com/ashleygwilliams/wasm-pack/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22)â€ï¼Œå¹¶æä¾›æŒ‡å¯¼å’ŒæŒ‡å¯¼ï¼ï¼‰ - æˆ‘ä»¬å¾ˆé«˜å…´ä¸æ‚¨åˆä½œï¼

## å…³äº [Ashley Williams](https://github.com/ashleygwilliams)

Ashley Williamsæ˜¯Integer32çš„ä¸€åå·¥ç¨‹å¸ˆï¼Œè´Ÿè´£Mozillaçš„Rustç¼–ç¨‹è¯­è¨€ã€‚å¥¹æ˜¯Rust Coreå›¢é˜Ÿçš„æˆå‘˜ï¼Œé¢†å¯¼Rustç¤¾åŒºå›¢é˜Ÿï¼Œå¹¶å¸®åŠ©ç»´æŠ¤Rustçš„è½¯ä»¶åŒ…æ³¨å†Œè¡¨crates.ioã€‚ä¹‹å‰ï¼Œå¥¹æ›¾åœ¨Javascriptçš„åŒ…ç®¡ç†å‘˜npmæ‹…ä»»å·¥ç¨‹å¸ˆï¼Œç›®å‰æ˜¯Node.jsåŸºé‡‘ä¼šè‘£äº‹ä¼šçš„ä¸ªäººä¼šå‘˜ã€‚ä½œä¸ºä¸€åæœ‰é•¿æœŸæ•™è‚²ç»å†çš„è€å¸ˆï¼ŒAshleyå°†å¤§éƒ¨åˆ†ç²¾åŠ›éƒ½é›†ä¸­åœ¨å¼€æºé¡¹ç›®çš„æ•™è‚²è®¡åˆ’ä¸Šï¼Œ2016å¹´åˆ›å»ºäº†NodeTogetherï¼Œç›®å‰æ­£åœ¨é¢†å¯¼RustBridgeè®¡åˆ’ã€‚å¥¹æ›¾ä»£è¡¨æ•™å¸ˆå‘TC39ä¼šè®®æå‡ºçœ‹æ³•æ¥å½±å“JavaScriptçš„å‘å±•ï¼Œå¹¶çƒ­è¡·äºé€šè¿‡å¥¹åœ¨WebAssemblyä¸Šçš„å·¥ä½œæ¥æ¨åŠ¨webçš„å‘å±•ã€‚